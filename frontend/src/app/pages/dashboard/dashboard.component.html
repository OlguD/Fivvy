<div class="dashboard" *ngIf="!loading && !errorMessage; else dashboardState">

	<section class="dashboard__metrics" *ngIf="summaryStats.length; else emptySummary">
		<article class="metric-card" *ngFor="let metric of summaryStats">
			<header class="metric-card__header">
			<span class="metric-card__label">{{ metric.label | translate }}</span>
						<span
							class="metric-card__trend"
							[ngClass]="{'metric-card__trend--down': metric.trend === 'down'}"
						>
							{{ metric.change }}
						</span>
			</header>
			<div class="metric-card__value">{{ metric.value }}</div>
			<!-- <div class="metric-card__spark" [ngClass]="{'metric-card__spark--down': metric.trend === 'down'}"></div> -->
		</article>
	</section>

		<section class="dashboard__grid dashboard__grid--single">
		<article class="panel panel--revenue panel--revenue-large" style="min-height: 480px;">
					<header class="panel__header">
						<div>
							<h2 class="panel__title">{{ 'dashboard.revenue.title' | translate }}</h2>
							<p class="panel__subtitle">{{ 'dashboard.revenue.subtitle' | translate }}</p>
						</div>
						<div style="display: flex; align-items: center; gap: 1.2rem;">
							<div class="revenue-total-badge" style="background: var(--primary, #2563eb); color: var(--btn-text); font-size: 1.08rem; font-weight: 600; border-radius: 1.2rem; padding: 0.45em 1.2em; margin-right: 0.2em; white-space: nowrap;">
								{{ 'dashboard.revenue.total' | translate }}: {{ getTotalRevenue() }}
							</div>
							<button mat-stroked-button type="button" class="panel__action" (click)="reload()">
								<mat-icon aria-hidden="true">refresh</mat-icon>
								{{ 'app.actions.reload' | translate }}
							</button>
						</div>
					</header>
			<div class="panel__body revenue-bar-chart" style="min-height: 340px;" *ngIf="revenueTrend.length; else noRevenue">
								<canvas baseChart
									[data]="barChartData"
									[options]="barChartOptions"
									[type]="'bar'"
									style="height: 320px; width: 100%; display: block; background: transparent;"
								></canvas>
			</div>
		</article>
	</section>

		<section class="dashboard__grid dashboard__grid--single">
		<article class="panel panel--activity">
					<header class="panel__header">
						<div>
							<h2 class="panel__title">{{ 'dashboard.activity.title' | translate }}</h2>
							<p class="panel__subtitle">{{ 'dashboard.activity.subtitle' | translate }}</p>
						</div>
						<button mat-button type="button" class="panel__link" (click)="reload()">
							{{ 'app.actions.reload' | translate }}
							<mat-icon aria-hidden="true">refresh</mat-icon>
						</button>
					</header>
			<ul class="activity-list" *ngIf="activities.length; else noActivities">
			<li *ngFor="let activity of activities" class="activity-item">
								<div class="activity-item__avatar">
									<span>{{ activity.avatar }}</span>
								</div>
								<div class="activity-item__content">
									<h3>{{ activity.title }}</h3>
									<p>{{ activity.description }}</p>
								</div>
								<div class="activity-item__meta">
									<span class="activity-item__timestamp">{{ activity.timestamp }}</span>
									<span class="activity-item__chip activity-item__chip--{{ activity.type }}">{{ ('dashboard.activity.type.' + activity.type) | translate }}</span>
								</div>
				</li>
			</ul>
		</article>
	</section>
</div>

<ng-template #dashboardState>
	<div class="dashboard__state" *ngIf="loading">{{ 'dashboard.state.loading' | translate }}</div>
	<div class="dashboard__state dashboard__state--error" *ngIf="!loading && errorMessage">
		<p>{{ errorMessage }}</p>
		<button mat-stroked-button type="button" (click)="reload()">
			<mat-icon aria-hidden="true">refresh</mat-icon>
			{{ 'app.actions.retry' | translate }}
		</button>
	</div>
</ng-template>

<ng-template #emptySummary>
	<div class="panel panel--empty">{{ 'dashboard.state.emptySummary' | translate }}</div>
</ng-template>

<ng-template #noRevenue>
	<p class="panel__empty">{{ 'dashboard.state.noRevenue' | translate }}</p>
</ng-template>

<ng-template #noInsights>
	<p class="panel__empty">{{ 'dashboard.state.noInsights' | translate }}</p>
</ng-template>

<ng-template #noActivities>
	<p class="panel__empty">{{ 'dashboard.state.noActivities' | translate }}</p>
</ng-template>
